{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getMenuByUser } from '@/api/api';\nconst state = {\n  activeMenuArrary: [],\n  activeMenu: \"/index\",\n  flag: false,\n  menus: [],\n  routes: [],\n  displayMenus: [],\n  btnMenus: []\n};\nconst getters = {\n  getMenu(state) {\n    return state.menus;\n  },\n  getFlag(state) {\n    return state.flag;\n  },\n  getRoutes(state) {\n    return state.routes;\n  },\n  getDisplayMenus(state) {\n    return state.displayMenus;\n  },\n  getBtnMenus(state) {\n    return state.btnMenus;\n  }\n};\nconst mutations = {\n  setActiveMenu(state, menu) {\n    state.activeMenu = menu;\n  },\n  addActiveMenu(state, menu) {\n    state.activeMenuArrary.push(menu);\n  },\n  reduceActiveMenu(state, i) {\n    state.activeMenuArrary.splice(i, 1);\n  },\n  setMenus(state, menus) {\n    state.menus = menus;\n  },\n  setFlag(state, flag) {\n    state.flag = flag;\n  },\n  setRoutes(state, routes) {\n    state.routes = routes;\n  },\n  setDisplayMenus(state, menus) {\n    state.displayMenus = menus;\n  },\n  setBtnMenus(state, btn) {\n    state.btnMenus = btn;\n  }\n};\nconst actions = {\n  generateRoutes({\n    commit\n  }) {\n    return new Promise(resolve => {\n      //根据用户获取菜单权限\n      getMenuByUser().then(res => {\n        if (res.code == 1000) {\n          var data = res.data;\n          commit(\"setMenus\", data);\n          commit(\"setFlag\", true);\n          //开始组装路由信息\n          var routes = filterRoutes(data);\n          routes.push({\n            path: '/:pathMatch(.*)',\n            redirect: '/404'\n          });\n          commit(\"setRoutes\", routes);\n          //遍历获取首页左侧菜单\n          var display = filterMenus(data);\n          for (let i = 0; i < display.length; i++) {\n            var item = display[i];\n            if (item.menuType == 1) {\n              commit(\"setActiveMenu\", item.routeUrl);\n              commit(\"addActiveMenu\", {\n                name: item.menuName,\n                url: item.routeUrl\n              });\n              break;\n            } else {\n              if (item.child.length > 0) {\n                commit(\"setActiveMenu\", item.child[0].routeUrl);\n                commit(\"addActiveMenu\", {\n                  name: item.child[0].menuName,\n                  url: item.child[0].routeUrl\n                });\n                break;\n              }\n            }\n          }\n          commit(\"setDisplayMenus\", display);\n          //遍历获取按钮权限\n          var btnMenus = filterBtnMenus(data);\n          commit(\"setBtnMenus\", btnMenus);\n          resolve(routes);\n        }\n      });\n    });\n  }\n};\nfunction filterBtnMenus(menus) {\n  var menu = [];\n  menus.forEach(item => {\n    if (item.menuType == 2) {\n      menu.push(item);\n    }\n  });\n  return menu;\n}\nfunction filterMenus(menus) {\n  var menu = [];\n  menus.forEach(item => {\n    //遍历一级菜单或目录\n    if (item.menuType != 2 && item.visible == 0 && item.parentId == \"0\") {\n      //一级菜单去找自己的下级\n      item.child = [];\n      if (item.menuType == 0) {\n        filterChildMenus(item, menus);\n      }\n      menu.push(item);\n    }\n  });\n  return menu;\n}\nfunction filterChildMenus(menu, menus) {\n  menu.child = [];\n  menus.forEach(item => {\n    if (menu.id == item.parentId) {\n      if (item.menuType == 0) {\n        filterChildMenus(item, menus);\n        menu.child.push(item);\n      } else if (item.menuType == 1) {\n        menu.child.push(item);\n      }\n    }\n  });\n}\nfunction filterRoutes(menus) {\n  var routes = [];\n  if (menus.length <= 0) {\n    return routes;\n  }\n  var root = {\n    path: \"\",\n    name: 'main',\n    component: () => import(`@/views/layout/index`),\n    redirect: '/index',\n    children: []\n  };\n  var children = [];\n  var index = 0;\n  //遍历出路由\n  menus.forEach(item => {\n    if (item.visible == 0 && index == 0) {\n      root.redirect = item.routeUrl;\n      index++;\n    }\n    //把菜单先遍历出来\n    if (item.menuType == 1) {\n      var param = {\n        path: item.routeUrl,\n        name: item.menuName,\n        component: loadView(item.componentUrl)\n      };\n      if (item.param) {\n        param.props = JSON.stringify(item.param);\n      }\n      if (item.target == 1) {\n        children.push(param);\n      }\n      if (item.target == 0) {\n        routes.push(param);\n      }\n    }\n  });\n  root.children = children;\n  routes.push(root);\n  return routes;\n}\nfunction loadView(view) {\n  if (process.env.NODE_ENV === 'development') {\n    return resolve => require([`@/views${view}`], resolve);\n  } else {\n    // 使用 import 实现生产环境的路由懒加载\n    return () => import(`@/views${view}`);\n  }\n}\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};","map":{"version":3,"names":["getMenuByUser","state","activeMenuArrary","activeMenu","flag","menus","routes","displayMenus","btnMenus","getters","getMenu","getFlag","getRoutes","getDisplayMenus","getBtnMenus","mutations","setActiveMenu","menu","addActiveMenu","push","reduceActiveMenu","i","splice","setMenus","setFlag","setRoutes","setDisplayMenus","setBtnMenus","btn","actions","generateRoutes","commit","Promise","resolve","then","res","code","data","filterRoutes","path","redirect","display","filterMenus","length","item","menuType","routeUrl","name","menuName","url","child","filterBtnMenus","forEach","visible","parentId","filterChildMenus","id","root","component","children","index","param","loadView","componentUrl","props","JSON","stringify","target","view","process","env","NODE_ENV","require","namespaced"],"sources":["D:/vue_project/back_stage_front/src/store/modules/menu.js"],"sourcesContent":["import { getMenuByUser } from '@/api/api'\r\nconst state = {\r\n  activeMenuArrary: [\r\n   \r\n  ],\r\n  activeMenu: \"/index\",\r\n  flag: false,\r\n  menus: [],\r\n  routes: [],\r\n  displayMenus: [],\r\n  btnMenus: []\r\n}\r\n\r\nconst getters ={\r\n  getMenu(state) {\r\n    return state.menus\r\n  },\r\n  getFlag(state) {\r\n    return state.flag\r\n  },\r\n  getRoutes(state) {\r\n    return state.routes\r\n  },\r\n  getDisplayMenus(state) {\r\n    return state.displayMenus\r\n  },\r\n  getBtnMenus(state) {\r\n    return state.btnMenus\r\n  }\r\n}\r\n\r\nconst mutations = {\r\n  setActiveMenu(state,menu) {\r\n      state.activeMenu = menu\r\n  },\r\n  addActiveMenu(state,menu) {\r\n      state.activeMenuArrary.push(menu)\r\n  },\r\n  reduceActiveMenu(state,i) {\r\n      state.activeMenuArrary.splice(i,1)\r\n  },\r\n  setMenus(state,menus) {\r\n      state.menus = menus\r\n  },\r\n  setFlag(state,flag) {\r\n    state.flag = flag\r\n  },\r\n  setRoutes(state,routes) {\r\n    state.routes = routes\r\n  },\r\n  setDisplayMenus(state,menus) {\r\n    state.displayMenus = menus\r\n  },\r\n  setBtnMenus(state,btn) {\r\n    state.btnMenus = btn\r\n  }\r\n}\r\n \r\nconst actions = {\r\n  generateRoutes({ commit }) {\r\n    return new Promise(resolve => {\r\n      //根据用户获取菜单权限\r\n      getMenuByUser().then(res => {\r\n        if(res.code == 1000) {\r\n          var data = res.data\r\n          commit(\"setMenus\",data)\r\n          commit(\"setFlag\",true)\r\n          //开始组装路由信息\r\n          var routes = filterRoutes(data)\r\n          routes.push({ path: '/:pathMatch(.*)', redirect: '/404'})\r\n          commit(\"setRoutes\",routes)\r\n          //遍历获取首页左侧菜单\r\n          var display = filterMenus(data)\r\n          for(let i = 0;i < display.length;i++) {\r\n            var item = display[i]\r\n            if(item.menuType == 1) {\r\n              commit(\"setActiveMenu\",item.routeUrl)\r\n              commit(\"addActiveMenu\",{name:item.menuName,url:item.routeUrl})\r\n              break;\r\n            } else {\r\n              if(item.child.length > 0) {\r\n                commit(\"setActiveMenu\",item.child[0].routeUrl)\r\n                commit(\"addActiveMenu\",{name:item.child[0].menuName,url:item.child[0].routeUrl})\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          commit(\"setDisplayMenus\",display)\r\n          //遍历获取按钮权限\r\n          var btnMenus = filterBtnMenus(data)\r\n          commit(\"setBtnMenus\",btnMenus)\r\n          resolve(routes)\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nfunction filterBtnMenus(menus) {\r\n  var menu = []\r\n  menus.forEach(item => {\r\n    if(item.menuType == 2) {\r\n      menu.push(item)\r\n    }\r\n  })\r\n  return menu\r\n}\r\n\r\nfunction filterMenus(menus) {\r\n  var menu = []\r\n  menus.forEach(item => {\r\n    //遍历一级菜单或目录\r\n    if(item.menuType != 2 && item.visible == 0 && item.parentId == \"0\") {\r\n      //一级菜单去找自己的下级\r\n      item.child = []\r\n      if(item.menuType == 0) {\r\n        filterChildMenus(item,menus)\r\n      }\r\n      menu.push(item)\r\n    }\r\n  })\r\n  return menu\r\n}\r\n\r\nfunction filterChildMenus(menu,menus) {\r\n  menu.child = []\r\n  menus.forEach(item => {\r\n    if(menu.id == item.parentId) {\r\n      if(item.menuType == 0) {\r\n        filterChildMenus(item,menus)\r\n        menu.child.push(item)\r\n      } else if(item.menuType == 1) {\r\n        menu.child.push(item)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nfunction filterRoutes(menus) {\r\n  var routes = []\r\n  if(menus.length <= 0) {\r\n    return routes;\r\n  }\r\n  var root = {\r\n    path: \"\",\r\n    name: 'main',\r\n    component: () => import(`@/views/layout/index`),\r\n    redirect: '/index',\r\n    children: []\r\n  }\r\n  var children = []\r\n  var index = 0;\r\n  //遍历出路由\r\n  menus.forEach(item => {\r\n    if(item.visible == 0 && index == 0) {\r\n      root.redirect = item.routeUrl\r\n      index ++;\r\n    }\r\n    //把菜单先遍历出来\r\n    if(item.menuType == 1) {\r\n      var param = {\r\n        path: item.routeUrl,\r\n        name: item.menuName,\r\n        component: loadView(item.componentUrl),\r\n      }\r\n      if(item.param) {\r\n        param.props = JSON.stringify(item.param)\r\n      }\r\n      if(item.target == 1) {\r\n        children.push(param)\r\n      }\r\n      if(item.target == 0) {\r\n        routes.push(param)\r\n      }\r\n    }\r\n  });\r\n  root.children = children\r\n  routes.push(root)\r\n  return routes;\r\n}\r\n\r\nfunction loadView(view){\r\n  if (process.env.NODE_ENV === 'development') {\r\n    return (resolve) => require([`@/views${view}`], resolve)\r\n  } else {\r\n    // 使用 import 实现生产环境的路由懒加载\r\n    return () => import(`@/views${view}`)\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  mutations,\r\n  actions\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}